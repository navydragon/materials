var x=class e{static log(r,...o){console.log(r,...o)}static warn(r,...o){console.warn(r,...o)}static error(r,...o){console.error(r,...o)}static assert(r,o){r||e.error("Assertion failed"+(o?": "+o:""))}};function a(e,r){return x.assert(e,r),e}function X(e){throw new Error(e)}function c(e){return e!==void 0}function Dr(e){return e===void 0}function b(e){return e===null}function fr(e){return Dr(e)||b(e)}function nr(e){return typeof e=="function"}function ir(e,r="assert failed"){e||X(r)}function g(e,r="verify failed"){return fr(e)&&X(r),e}function sr(){let e,r;return{promise:new Promise((t,p)=>{e=t,r=p}),resolve:e,reject:r}}function xr({type:e,edge:r,fn:o,timeout:t}){let p,m;ir(e!=="debounce"||r!=="leading");function f(l){c(p)&&(clearTimeout(p),p=void 0),l&&(p=setTimeout(l,t))}function i(){if(!m)return;let l,{params:A,resolve:G,reject:Q}=m;m=void 0;try{l=o(...A),G(l)}catch($){f(),m=void 0,Q($)}return l}function n(){m==null||m.resolve(void 0),m=void 0}let s=(...l)=>{n();let A=c(p);if(!A||e==="debounce"){let mr=()=>{f(m&&r==="leading"?mr:void 0),i()};f(mr)}let{promise:G,resolve:Q,reject:$}=sr();return m={params:l,resolve:Q,reject:$},r==="leading"&&!A&&i(),G};return s.isPending=()=>!!m,s.flush=()=>(f(),i()),s.force=(...l)=>(s.cancel(),o(...l)),s.cancel=()=>{f(),n()},s}var Y=(e,r,o="trailing")=>xr({type:"throttle",fn:e,timeout:r,edge:o});function ar(e,r){let o=e.indexOf(r),t=o>=0;return t&&e.splice(o,1),t}function lr(e){let r=typeof e;return r==="object"&&e!=null||r==="function"}var Or=0,I=class{constructor(r,o,t,p,m=null){this.listener=r,this.src=o,this.type=t,this.capture=!!p,this.handler=m,this.key=++Or}};var R=class extends I{constructor(r,o,t,p,m,f){super(r,t,p,m,f),this.proxy=o,this.callOnce=!1,this.removed=!1}markAsRemoved(){this.removed=!0,this.listener=null,this.proxy=null,this.src=null,this.handler=null}};function cr(e,r,o){for(let t in e)if(r.call(o,e[t],t,e))return!0;return!1}function ur(e,r,o){if(e){for(let t in e)if(r.call(o,e[t],t,e))return t}}function dr(e,r){for(let o in e)if(!(o in r)||e[o]!==r[o])return!1;for(let o in r)if(!(o in e))return!1;return!0}function hr(e,r,o){let t={};if(e)for(let p in e)r.call(o,e[p],p,e)&&(t[p]=e[p]);return t}var C=class{constructor(r){this.src=r,this.listeners={},this._typeCount=0}getTypeCount(){return this._typeCount}getListenerCount(){let r=0;for(let o of Object.keys(this.listeners))r+=this.listeners[o].length;return r}add(r,o,t,p,m){let f=r.toString(),i=this.listeners[f];i||(i=this.listeners[f]=[],this._typeCount++);let n,s=this._findListenerIndex(i,o,p,m);return s>-1?(n=i[s],t||(n.callOnce=!1)):(n=new R(o,null,this.src,f,!!p,m),n.callOnce=t,i.push(n)),n}remove(r,o,t,p){let m=r.toString();if(!(m in this.listeners))return!1;let f=this.listeners[m],i=this._findListenerIndex(f,o,t,p);return i>-1?(f[i].markAsRemoved(),f.splice(i,1),f.length===0&&(delete this.listeners[m],this._typeCount--),!0):!1}removeByKey(r){let o=r.type;if(!(o in this.listeners))return!1;let t=this.listeners[o],p=t.indexOf(r),m=p>=0;return m&&(t.splice(p,1),r.markAsRemoved(),this.listeners[o].length===0&&(delete this.listeners[o],--this._typeCount)),m}getListeners(r,o){let t=this.listeners[r.toString()],p=[];if(t)for(let m=0;m<t.length;++m){let f=t[m];f.capture==o&&p.push(f)}return p}getListener(r,o,t,p){let m=this.listeners[r.toString()],f=-1;return m&&(f=this._findListenerIndex(m,o,t,p)),f>-1?m[f]:null}hasListener(r="",o=void 0){let t=c(r),p=t?r.toString():"",m=c(o);return cr(this.listeners,f=>{for(let i=0;i<f.length;++i)if((!t||f[i].type==p)&&(!m||f[i].capture==o))return!0;return!1})}_findListenerIndex(r,o,t,p){for(let m=0;m<r.length;++m){let f=r[m];if(!f.removed&&f.listener==o&&f.capture==!!t&&f.handler==p)return m}return-1}};var J="ispring_lm_"+(Math.random()*1e6|0),q;function Ur(){if(!_.addEventListener||!Object.defineProperty)return!1;let e=!1,r=Object.defineProperty({},"passive",{get:function(){e=!0}});return _.addEventListener("test",Function.prototype,r),_.removeEventListener("test",Function.prototype,r),e}function Mr(){return c(q)||(q=Ur()),q}function Z(e){let r=e[J];return r instanceof C?r:null}function S(e){let r=e;if(!r||r.removed)return!1;let o=r.src,t=r.type,p=r.proxy;o.removeEventListener&&o.removeEventListener(t,p,r.capture);let m=Z(o);return m?(m.removeByKey(r),m.getTypeCount()===0&&(o[J]=null)):r.markAsRemoved(),!0}function Fr(e){let{listener:r,handler:o,callOnce:t}=e,p=o?r.bind(o):r;return t?(...m)=>{p(...m),S(e)}:p}function E(e,r,o,t,p=null){let m=lr(t)?a(t).capture:!!t,f=Z(e);f||(f=new C(e),e[J]=f);let i=!!(t&&t.once),n=f.add(r,o,i,m,p);if(n.proxy)return n;let s=Fr(n);if(n.proxy=s,e.addEventListener){let l=Mr()?t:m;c(l)||(l=!1),e.addEventListener(r.toString(),s,l)}else throw new Error("addEventListener is unavailable.");return n}function gr(e,r,o,t,p){t=!!t;let m=Z(e);return m?m.getListener(r,o,t,p):null}var w=class{dispose(){}};var Nr=0,D=class extends w{constructor(){super(),this._listenersKeys=null,this._activeSignals=null,this._disposables=null,this._customDestructHandlers=null}addDestructHandler(r){this._customDestructHandlers=this._customDestructHandlers||[],this._customDestructHandlers.push(r)}dispose(){if(this._destruct(),this._customDestructHandlers)for(let r of this._customDestructHandlers)r();if(this._disposables)for(let r of this._disposables)rr(r);if(this._listenersKeys){for(let r of this._listenersKeys)S(r);this._listenersKeys=null}if(this._activeSignals)for(let r of Object.keys(this._activeSignals))this._removeSignalByKey(r)}_listen(r,o,t,p){this._listenersKeys=this._listenersKeys||[];let m=E(this._getEventTarget(r),o,t,p,this);return this._listenersKeys.push(m),m}_unlisten(r,o,t){let p=gr(this._getEventTarget(r),o,t,!1);return!!p&&this._unlistenByKey(p)}_unlistenByKey(r){let o=a(this._listenersKeys),t=o.indexOf(r);return t>=0&&o.splice(t,1),S(r)}_addSignal(r,o,t){this._activeSignals=this._activeSignals||{},r.add(o,this,t);let p=++Nr;return this._activeSignals[p]={dispatcher:r,fn:o,priority:t},p}_addSignalCallOnce(r,o,t){let p=(...m)=>{o.apply(this,m),this._removeSignal(r,p,t)};this._addSignal(r,p,t)}_removeSignal(r,o,t){let p=ur(this._activeSignals,m=>dr(m,{dispatcher:r,fn:o,priority:t}));p&&this._removeSignalByKey(p)}_removeSignalByKey(r){if(!(this._activeSignals&&this._activeSignals[r])){x.warn("unknown signal key");return}let{dispatcher:o,fn:t,priority:p}=this._activeSignals[r];o.remove(t,this,p),delete this._activeSignals[r]}_removeAllEvents(r){if(r){if(this._activeSignals){let o=hr(this._activeSignals,t=>t.dispatcher.eventOwner()===r);for(let t of Object.keys(o))this._removeSignalByKey(t)}if(this._listenersKeys){let o=this._getEventTarget(r),t=this._listenersKeys.filter(p=>p.src===o);for(let p of t)this._unlistenByKey(p)}}}_addDisposable(r){return this._disposables=this._disposables||[],!r||this._disposables.includes(r)||this._disposables.push(r),r}_removeDisposable(...r){if(this._disposables){for(let o of r)if(o){this._cleanItemDependencies(o);let t=this._disposables.indexOf(o);t>=0&&(this._disposables.splice(t,1),rr(o))}}}_cleanItemDependencies(r){this._removeAllEvents(r)}_cleanDependencies(...r){for(let o of r)o&&this._cleanItemDependencies(o)}_getEventTarget(r){return r}_destruct(){}};function Vr(e,r){return e>r?1:e<r?-1:0}function kr(e,r,o,t,p){let m=0,f=e.length,i;for(;m<f;){let n=m+f>>1,s;o?s=r.call(p,e[n],n,e):s=r(t,e[n]),s>0?m=n+1:(f=n,i=!s)}return i?m:~m}function Br(e,r,o=Vr){return kr(e,o,!1,r)}function _r(e,r,o){let t=Br(e,r,o);return t<0?(e.splice(-(t+1),0,r),!0):!1}var O=class{constructor(){this._priorities=null,this._values=null,this._zeroPriorityValues=null}push(r,o){this._addPriority(o);let t=this._getPriorityValues(o);t?t.push(r):x.warn("Priority array values are zero")}remove(r,o){let t=this._getPriorityValues(o);t&&ar(t,r)}removeAt(r,o){let t=this._getPriorityValues(o);t&&t.splice(r,1)}getValuesWithPriority(r){if(r===0)return this._zeroPriorityValues||[];if(!this._values)return x.warn("Priority array values are zero"),[];if(!(r in this._values))return[];let o=this._getPriorityValues(r);return o||(x.warn("Priority array values are zero"),[])}getAllValues(){if(!this._values)return this._zeroPriorityValues?this._zeroPriorityValues.slice():[];let r=[],o=a(this._priorities);for(let t=0;t<o.length;++t){let p=o[t],m=this._getPriorityValues(p);m&&r.push(...m)}return r}_addPriority(r){if(r===0){this._zeroPriorityValues=this._zeroPriorityValues||[];return}this._priorities=this._priorities||[0],this._values=this._values||{},r in this._values||(this._values[r]=[],_r(this._priorities,r))}_getPriorityValues(r){return r===0?this._zeroPriorityValues:a(this._values)[r]}};var y=class extends D{constructor(r=null){super(),this._handlers=null,this._owner=r}eventOwner(){return this._owner}add(r,o,t=0){this._handlers=this._handlers||new O,this._handlers.push({fn:r,context:o},t)}addCallOnce(r,o,t=0){let p=m=>{r.call(o,m),this.remove(p,o,t)};this.add(p,o,t)}remove(r,o,t=0){if(!this._handlers){x.warn("Signal has no handlers!");return}let p=this._handlers.getValuesWithPriority(t),m=p.length;for(let f=0;f<m;++f){let i=g(p[f]);if(i.fn===r&&i.context===o){this._handlers.removeAt(f,t);break}}}has(r,o,t=0){if(!this._handlers)return!1;let p=this._handlers.getValuesWithPriority(t),m=p.length;for(let f=0;f<m;++f){let i=g(p[f]);if(i.fn===r&&i.context===o)return!0}return!1}dispatch(r){if(!this._handlers)return;let o=this._handlers.getAllValues(),t=o.length;for(let p=0;p<t;++p){let m=g(o[p]);if(this._handlers.getAllValues().indexOf(m)!==-1)try{m.fn.apply(m.context,[r])}catch(f){or(f,!0)}}}toFn(){return r=>this.dispatch(r)}handlersCount(){return this._handlers?this._handlers.getAllValues().length:0}};var _=Function("return this")(),zr=()=>!0;function er(e,r){if(zr()){if(r){x.error(e);return}x.warn(e)}}function or(e,r){let o=e.stack||e.toString();String(o).indexOf(e.message)<0&&er(e.message,r),er(o,r)}var $o=Object.getPrototypeOf({});function rr(e){e&&(a(!e.disposed),nr(e.dispose)&&e.dispose(),e.disposed=!0)}function Sr(e,r){let o=e.split("."),t=_;!(a(o[0])in t)&&typeof t.execScript!="undefined"&&t.execScript("var "+o[0]);for(let p;o.length&&(p=o.shift());)!o.length&&c(r)?t[p]=r:t[p]&&t[p]!==Object.prototype[p]?t=t[p]:t=t[p]={}}_.onerror=function(...e){let[r,,,,o]=e;return o?or(o,!0):er(r,!0),!0};var tr={CLICK:"click",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",CHANGE:"change",SELECTION_CHANGE:"selectionchange",INPUT:"input",TEXT_INPUT:"textInput",KEY_DOWN:"keydown",KEY_PRESS:"keypress",PASTE:"paste",CUT:"cut",COPY:"copy",BLUR:"blur",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",LOAD:"load",LOAD_END:"loadend",LOADED_METADATA:"loadedmetadata",UNLOAD:"unload",BEFOREUNLOAD:"beforeunload",ERROR:"error",DRAG_START:"dragstart",DRAG_OVER:"dragover",DRAG_END:"dragend",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DROP:"drop",RESIZE:"resize",SCROLL:"scroll",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",ORIENTATIONCHANGE:"orientationchange",CUSTOM_CONNECTED:"connected",CUSTOM_DISCONNECTED:"disconnected",TRANSITIONEND:"transitionend",TOUCHSTART:"touchstart",VISIBILITYCHANGE:"visibilitychange"};function U(e,r,o=!0){if(o)return String(parseFloat(e.toFixed(r)));let t=10**r;return String(Math.floor(e*t)/t)}var M=class{constructor(r){this._options=r}usePassedStatus(r){return!!(this._options&(r?2:1))}};function Pr(e){let r=Math.floor(e/3600),o=Math.floor(e%3600/60),t=Math.floor(e%60),p=e-Math.floor(e);return{h:r,m:o,s:t,ms:p}}function pr(e){return e<10?"0"+e:e}function F(e){let r=Pr(e);return"PT"+r.h+"H"+r.m+"M"+r.s+"S"}function v(e){let r=Pr(e);return pr(r.h)+":"+pr(r.m)+":"+pr(r.s)}function T(e){return e<10?"0"+e:e}function Cr(e){return typeof e=="number"&&(e=new Date(e)),e.getUTCFullYear()+"-"+T(e.getUTCMonth()+1)+"-"+T(e.getUTCDate())+"T"+T(e.getUTCHours())+":"+T(e.getUTCMinutes())+":"+T(e.getUTCSeconds())+".0Z"}function Er(e){let r=document.createElement("a");r.href="goodbye.html",r.click()}function d(){try{window==window.top?(window.open("","_self",""),window.close()):Er(window)}catch{Er(a(window.top))}}function Tr(e){return e.trim().replace(/[^\w-]/g,"_")}var Hr={id:"id",type:"type",score:"weighting",correctResponse:"correct_responses.%INDEX%.pattern",userResponse:"student_response",result:"result",duration:"latency",visitTime:"time"},Kr={id:"id",type:"type",score:"weighting",correctResponse:"correct_responses.%INDEX%.pattern",userResponse:"learner_response",description:"description",result:"result",duration:"latency",visitTime:"timestamp"},Wr={};function vr(e){return"cmi.interactions."+e+"."}function Lr(e){return parseInt(e.getValue("cmi.interactions._count"),10)}function Ar(e,r,o,t,p){if(p){let n=e.id+"_"+e.description,s=Tr(n.substr(0,255));o.setValue(r+t.id,s)}else o.setValue(r+t.id,e.id);o.setValue(r+t.type,e.type),o.setValue(r+t.score,e.score);let m=e.correctResponses||[];for(let n=0;n<m.length;++n){let s=t.correctResponse.replace("%INDEX%",String(n));o.setValue(r+s,m[n])}let f=e.userResponse;f!=null&&o.setValue(r+t.userResponse,f);function i(n){return p&&n==="incorrect"?"wrong":n}o.setValue(r+t.result,i(e.result))}function br(e,r){let o=Wr,t=e.id,p=-1;if(e.id in o?p=o[t]:(p=Lr(r),o[t]=p),p<0)return;let m=vr(p),f=Hr;Ar(e,m,r,f,!0);let i=e.duration;i!=null&&r.setValue(m+f.duration,v(i/1e3));let n=e.visitTime;if(n!=null){let s=n.getHours()*3600+n.getMinutes()*60+n.getSeconds();r.setValue(m+f.visitTime,v(s))}}function Ir(e,r){let o=Lr(r);if(o<0)return;let t=vr(o),p=Kr;Ar(e,t,r,p,!1),r.setValue(t+p.description,e.description);let m=e.duration;m!=null&&r.setValue(t+p.duration,F(m/1e3));let f=e.visitTime;f!=null&&r.setValue(t+p.visitTime,Cr(f))}var N={NORMAL:"normal",BROWSE:"browse",REVIEW:"review"};function Rr(e,r){try{for(let t=0;t<255;++t){if(e[r])return e[r];let p=e.parent;if(!p||e==p)break;e=p}}catch{}return null}function V(e,r){return Rr(e,r)||e.opener&&Rr(e.opener,r)}var k=class e{constructor(r,o){this._api=r,this._passed=!1,this._commitsCount=0,this._suspendEnabled=o}static create(r){let o=V(window,"API");return o?new e(o,r):null}initialize(){try{return this._toBool(this._api.LMSInitialize(""))}catch{}return!1}terminate(r){this.setValue("cmi.core.exit",r?this._getSuspendState():""),this.commit();try{return this._toBool(this._api.LMSFinish(""))}catch{}return!1}_getSuspendState(){return this._passed?"":"suspend"}commit(){this._commitsCount==0&&this.setValue("cmi.core.exit",this._suspendEnabled?this._getSuspendState():"");try{let r=this._toBool(this._api.LMSCommit(""));return this._commitsCount+=1,r}catch{}return!1}setPassed(r){this._passed=r}getValue(r){try{return this._api.LMSGetValue(r)}catch{}return""}setValue(r,o){typeof o=="number"&&(o=U(Number(o),2)+"");try{return this._toBool(this._api.LMSSetValue(r,o))}catch{}return!1}_toBool(r){return r=="true"}};var B=class{constructor(r){this._base=k.create(r),this._initialized=!1}initialize(){return this._initialized?!0:(this._initialized=this._base?this._base.initialize():!1,this._initialized)}initializeAsync(r,o){if(this._initialized){r();return}this._base?(this._initialized=this._base.initialize(),this._initialized?r():o()):(this._initialized=!1,o())}terminate(r){return this._base?this._base.terminate(r):!1}commit(){return this._base?this._base.commit():!1}getValue(r){return this._base?this._base.getValue(r):""}setValue(r,o){return this._base?this._base.setValue(r,o):!1}setScore(r,o,t,p){this.setValue("cmi.core.score.raw",r),this.setValue("cmi.core.score.min",o),this.setValue("cmi.core.score.max",t)}setProgress(r){}setSessionTime(r){this.setValue("cmi.core.session_time",v(r/1e3))}getSuspendedData(){return this.getValue("cmi.suspend_data")}getLaunchMode(){return N.NORMAL}setSuspendedData(r){this.setValue("cmi.suspend_data",r)}setStatus(r,o){b(r)?b(o)?this.setValue("cmi.core.lesson_status","unknown"):this.setValue("cmi.core.lesson_status",o?"completed":"incomplete"):this.setValue("cmi.core.lesson_status",r?"passed":"failed")}setPassed(r){g(this._base).setPassed(r)}addInteraction(r){br(r,this)}getUserInfo(){return{id:this.getValue("cmi.core.student_id"),name:this.getValue("cmi.core.student_name"),email:""}}};var z={SECOND:"2",THIRD:"3",FOURTH:"4"};var H=class e{constructor(r,o,t){this._api=r,this._edition=o,this._passed=!1,this._commitsCount=0,this._suspendEnabled=t}static create(r,o){let t=V(window,"API_1484_11");return t?new e(t,r,o):null}initialize(){try{return this._toBool(this._api.Initialize(""))}catch{}return!1}terminate(r){this.setValue("cmi.exit",r?this._getSuspendState():"normal"),this.setValue("adl.nav.request","exitAll"),this.commit();try{return this._toBool(this._api.Terminate(""))}catch{}return!1}_getSuspendState(){return this._passed?"":"suspend"}commit(){this._commitsCount==0&&this.setValue("cmi.exit",this._suspendEnabled?this._getSuspendState():"normal");try{let r=this._toBool(this._api.Commit(""));return this._commitsCount+=1,r}catch{}return!1}getValue(r){try{return this._api.GetValue(r)}catch{}return""}setValue(r,o){typeof o=="number"&&(o=U(o,7));try{return this._toBool(this._api.SetValue(r,o))}catch{}return!1}setPassed(r){this._passed=r}getSuspendDataLimit(){return this._edition==z.SECOND?4e3:64e3}_toBool(r){return r=="true"}};var K=class{constructor(r,o){this._base=H.create(r,o),this._initialized=!1}initialize(){return this._initialized?!0:(this._initialized=this._base?this._base.initialize():!1,this._initialized)}initializeAsync(r,o){if(this._initialized){r();return}this._base?(this._initialized=this._base.initialize(),this._initialized?r():o()):(this._initialized=!1,o())}terminate(r){return this._base?this._base.terminate(r):!1}commit(){return this._base?this._base.commit():!1}getValue(r){return this._base?this._base.getValue(r):""}setValue(r,o){return this._base?this._base.setValue(r,o):!1}setScore(r,o,t,p=0){this.setValue("cmi.score.raw",r),this.setValue("cmi.score.min",o),this.setValue("cmi.score.max",t),this.setValue("cmi.score.scaled",p)}setProgress(r){this.setValue("cmi.progress_measure",r)}setSessionTime(r){this.setValue("cmi.session_time",F(r/1e3))}getSuspendedData(){return this.getValue("cmi.suspend_data")}setSuspendedData(r){if(!this._base)throw new Error;let o=this._base.getSuspendDataLimit();r.length<=o&&this.setValue("cmi.suspend_data",r)}getLaunchMode(){return this._base?this._base.getValue("cmi.mode"):N.NORMAL}setStatus(r,o){let t=(p,m,f,i)=>p===null?m:p?f:i;this.setValue("cmi.success_status",t(r,"unknown","passed","failed")),this.setValue("cmi.completion_status",t(o,"unknown","completed","incomplete"))}setPassed(r){this._base&&this._base.setPassed(r)}addInteraction(r){Ir(r,this)}getUserInfo(){return{id:this.getValue("cmi.learner_id"),name:this.getValue("cmi.learner_name"),email:""}}};function wr(){return{onSessionStart:new y,onSessionEnd:new y}}var jr=6e4;var h=class{constructor(r,o){this._apiVersion=r,this._config=o,this._active=!1,this._playerApi=null,this._suspendEnabled=!0,this._startTime=0,this._lmsApi=null,this._closeEventKeys=[],this._chaptersCompletionStatuses=[],this._longreadResult=null,this._longreadGraded=!1,this._sessionStateNotifier=wr(),this._commit=Y(()=>{},0)}initializeLms(r){try{let o=new M(this._config.flags);this._lmsApi=this._createLmsApi(this._apiVersion,o,this._suspendEnabled),this._commit=Y(this._lmsApi.commit.bind(this._lmsApi),jr)}catch(o){x.error(o),this._onLmsApiInitializationFailed(r)}this._lmsApi&&this._lmsApi.initialize(this._onLmsApiInitialized.bind(this,r),this._onLmsApiInitializationFailed.bind(this,r))}_createLmsApi(r,o,t){}_onLmsApiInitialized(r){let t=a(this._lmsApi).getSuspendData();r(t||void 0).then(m=>this._start(m)),this._closeEventKeys=[E(window,tr.UNLOAD,()=>this._closeLms()),E(window,tr.BEFOREUNLOAD,()=>this._closeLms())]}_onLmsApiInitializationFailed(r){x.error("Lms initialization failed"),r().then(()=>{})}_start(r){this._playerApi=r,this._active=!0,this._startTime=Date.now(),this._sessionStateNotifier.onSessionStart.dispatch(r.getTitle()),r.onClosePlayerRequest.add(()=>{this._closeLms(),d()}),this._longreadGraded=r.isGraded(),this._chaptersCompletionStatuses=r.getCurrentSectionsStateProgress();let o=()=>{this._longreadResult=r.getLongreadResult(),this._updateUserProgress()};r.onPersistedStateChange.add(()=>this._updatePersistedState()),r.onSectionProgressChange.add(()=>{let t=r.getCurrentSectionIndex(),p=r.getCurrentSectionProgress(),m=a(this._lmsApi),f=t>=0&&!this._chaptersCompletionStatuses[t]&&p>=1;f&&(m.setItemViewed(t),this._chaptersCompletionStatuses[t]=!0),o(),f&&this._commit.flush()}),r.onLongreadResultChange.add(()=>o()),r.onQuizStatisticChange.add(()=>{o(),this._commit.flush()}),o()}_createIri(){return`ispring://roll/${encodeURIComponent(this._config.contentId)}`}_closeLms(){if(this._closeEventKeys)for(let o of this._closeEventKeys)S(o);this._active&&(this._active=!1,this._updateDuration(),this._updateUserProgressOnClose()),this._sessionStateNotifier.onSessionEnd.dispatch();let r=a(this._lmsApi);this._suspendEnabled?r.suspend():r.terminate()}_updateUserProgressOnClose(){}_updateUserProgress(){let r=a(this._lmsApi);this._longreadResult&&(this._longreadGraded&&this._longreadResult.score!==null?(r.setScore(this._longreadResult.score,0,100),r.setStatus(this._longreadResult.longreadPassed,this._longreadResult.completed)):r.setStatus(null,this._longreadResult.completed),r.setProgress(this._longreadResult.progress/100),this._commit().catch(o=>x.error(o)))}_updateDuration(){let r=Date.now()-this._startTime;a(this._lmsApi).setLessonDuration(r)}_updatePersistedState(){this._suspendEnabled&&this._playerApi&&this._lmsApi&&this._lmsApi.setSuspendData(this._playerApi.getSuspendData())}};var P=class{constructor(){this._connector=null}createConnector(){}getLearnerPreferences(){return null}initialize(r,o){this._connector=this.createConnector(),this._connector?this._connector.initializeAsync(r,o):o()}commit(){this._getConnector().commit()}suspend(){this._getConnector().terminate(!0),d()}terminate(){this._getConnector().terminate(!1),d()}setSuspendData(r){this._getConnector().setSuspendedData(r)}getSuspendData(){return this._getConnector().getSuspendedData()}setStatus(r,o){this._getConnector().setStatus(r,o)}setScore(r,o,t,p){let m=t-o>0?r/(t-o):0;p!=null&&(r=m*p,t=p),this._getConnector().setScore(r,o,t,m)}setItemViewed(r){}setProgress(r){this._getConnector().setProgress(r)}setLessonDuration(r){this._getConnector().setSessionTime(r)}getUserInfo(){return this._getConnector().getUserInfo()}_getConnector(){if(!this._connector)throw new Error("Connector not created");return this._connector}};var W=class extends P{constructor(r,o){super(),this._reportOptions=r,this._suspendEnabled=o}createConnector(){return new B(this._suspendEnabled)}setStatus(r,o){this._getConnector().setStatus(r,o)}suspend(){super.suspend(),d()}terminate(){super.terminate(),d()}};var j=class extends P{constructor(r,o=z.SECOND){super(),this._edition=o,this._suspendEnabled=r}createConnector(){return new K(this._edition,this._suspendEnabled)}};function Gr(e){return{apiVersion:e.apiVersion,flags:e.flags,contentId:e.contentId,edition:e.edition}}var L=class e extends h{constructor(r){super(r.apiVersion,r),this._scormConfig=r}static create(r){return new e(Gr(r))}_createLmsApi(r,o,t){switch(r){case"scorm12":return new W(o,t);case"scorm2004":return new j(t,this._scormConfig.edition)}throw new Error("unknown api version")}};Sr("iSpring.roll.LMS.create",L.create);h.prototype.initialize=h.prototype.initializeLms;
