function Q(e){throw new Error(e)}function c(e){return e!==void 0}function Lr(e){return e===void 0}function O(e){return e===null}function pr(e){return Lr(e)||O(e)}function mr(e){return typeof e=="function"}function sr(e,r="assert failed"){e||Q(r)}function h(e,r="verify failed"){return pr(e)&&Q(r),e}function nr(){let e,r;return{promise:new Promise((t,f)=>{e=t,r=f}),resolve:e,reject:r}}function xr({type:e,edge:r,fn:o,timeout:t}){let f,p;sr(e!=="debounce"||r!=="leading");function m(l){c(f)&&(clearTimeout(f),f=void 0),l&&(f=setTimeout(l,t))}function n(){if(!p)return;let l,{params:R,resolve:j,reject:W}=p;p=void 0;try{l=o(...R),j(l)}catch(Y){m(),p=void 0,W(Y)}return l}function s(){p?.resolve(void 0),p=void 0}let x=(...l)=>{s();let R=c(f);if(!R||e==="debounce"){let fr=()=>{m(p&&r==="leading"?fr:void 0),n()};m(fr)}let{promise:j,resolve:W,reject:Y}=nr();return p={params:l,resolve:W,reject:Y},r==="leading"&&!R&&n(),j};return x.isPending=()=>!!p,x.flush=()=>(m(),n()),x.force=(...l)=>(x.cancel(),o(...l)),x.cancel=()=>{m(),s()},x}var X=(e,r,o="trailing")=>xr({type:"throttle",fn:e,timeout:r,edge:o});var i={log:(...e)=>{console.log(...e)},warn:(...e)=>{console.warn(...e)},error:(...e)=>{console.error(...e)},assert:(e,r)=>{if(!e){let o=r?": "+r:"";i.error("Assertion failed"+o)}}};function ir(e,r){let o=e.indexOf(r),t=o>=0;return t&&e.splice(o,1),t}function a(e,r){return i.assert(!!e,r),e}function ar(e){let r=typeof e;return r==="object"&&e!=null||r==="function"}var wr=0,A=class{constructor(r,o,t,f,p=null){this.listener=r,this.src=o,this.type=t,this.capture=!!f,this.handler=p,this.key=++wr}};var P=class extends A{constructor(r,o,t,f,p,m){super(r,t,f,p,m),this.proxy=o,this.callOnce=!1,this.removed=!1}markAsRemoved(){this.removed=!0,this.listener=null,this.proxy=null,this.src=null,this.handler=null}};function lr(e,r,o){for(let t in e)if(r.call(o,e[t],t,e))return!0;return!1}function cr(e,r,o){if(e){for(let t in e)if(r.call(o,e[t],t,e))return t}}function ur(e,r){for(let o in e)if(!(o in r)||e[o]!==r[o])return!1;for(let o in r)if(!(o in e))return!1;return!0}function dr(e,r,o){let t={};if(e)for(let f in e)r.call(o,e[f],f,e)&&(t[f]=e[f]);return t}var E=class{constructor(r){this.src=r,this.listeners={},this._typeCount=0}getTypeCount(){return this._typeCount}getListenerCount(){let r=0;for(let o of Object.keys(this.listeners))r+=this.listeners[o].length;return r}add(r,o,t,f,p){let m=r.toString(),n=this.listeners[m];n||(n=this.listeners[m]=[],this._typeCount++);let s,x=this._findListenerIndex(n,o,f,p);return x>-1?(s=n[x],t||(s.callOnce=!1)):(s=new P(o,null,this.src,m,!!f,p),s.callOnce=t,n.push(s)),s}remove(r,o,t,f){let p=r.toString();if(!(p in this.listeners))return!1;let m=this.listeners[p],n=this._findListenerIndex(m,o,t,f);return n>-1?(m[n].markAsRemoved(),m.splice(n,1),m.length===0&&(delete this.listeners[p],this._typeCount--),!0):!1}removeByKey(r){let o=r.type;if(!(o in this.listeners))return!1;let t=this.listeners[o],f=t.indexOf(r),p=f>=0;return p&&(t.splice(f,1),r.markAsRemoved(),this.listeners[o].length===0&&(delete this.listeners[o],--this._typeCount)),p}getListeners(r,o){let t=this.listeners[r.toString()],f=[];if(t)for(let p=0;p<t.length;++p){let m=t[p];m.capture==o&&f.push(m)}return f}getListener(r,o,t,f){let p=this.listeners[r.toString()],m=-1;return p&&(m=this._findListenerIndex(p,o,t,f)),m>-1?p[m]:null}hasListener(r="",o=void 0){let t=c(r),f=t?r.toString():"",p=c(o);return lr(this.listeners,m=>{for(let n=0;n<m.length;++n)if((!t||m[n].type==f)&&(!p||m[n].capture==o))return!0;return!1})}_findListenerIndex(r,o,t,f){for(let p=0;p<r.length;++p){let m=r[p];if(!m.removed&&m.listener==o&&m.capture==!!t&&m.handler==f)return p}return-1}};var q="ispring_lm_"+(Math.random()*1e6|0),$;function br(){if(!_.addEventListener||!Object.defineProperty)return!1;let e=!1,r=Object.defineProperty({},"passive",{get:function(){e=!0}});return _.addEventListener("test",Function.prototype,r),_.removeEventListener("test",Function.prototype,r),e}function Dr(){return c($)||($=br()),$}function J(e){let r=e[q];return r instanceof E?r:null}function g(e){let r=e;if(!r||r.removed)return!1;let o=r.src,t=r.type,f=r.proxy;o.removeEventListener&&o.removeEventListener(t,f,r.capture);let p=J(o);return p?(p.removeByKey(r),p.getTypeCount()===0&&(o[q]=null)):r.markAsRemoved(),!0}function Nr(e){let{listener:r,handler:o,callOnce:t}=e,f=o?r.bind(o):r;return t?(...p)=>{f(...p),g(e)}:f}function T(e,r,o,t,f=null){let p=ar(t)?a(t).capture:!!t,m=J(e);m||(m=new E(e),e[q]=m);let n=!!(t&&t.once),s=m.add(r,o,n,p,f);if(s.proxy)return s;let x=Nr(s);if(s.proxy=x,e.addEventListener){let l=Dr()?t:p;c(l)||(l=!1),e.addEventListener(r.toString(),x,l)}else throw new Error("addEventListener is unavailable.");return s}function hr(e,r,o,t,f){t=!!t;let p=J(e);return p?p.getListener(r,o,t,f):null}var L=class{dispose(){}};var Mr=0,w=class extends L{constructor(){super(),this._listenersKeys=null,this._activeSignals=null,this._disposables=null,this._customDestructHandlers=null}addDestructHandler(r){this._customDestructHandlers=this._customDestructHandlers||[],this._customDestructHandlers.push(r)}dispose(){if(this._destruct(),this._customDestructHandlers)for(let r of this._customDestructHandlers)r();if(this._disposables)for(let r of this._disposables)Z(r);if(this._listenersKeys){for(let r of this._listenersKeys)g(r);this._listenersKeys=null}if(this._activeSignals)for(let r of Object.keys(this._activeSignals))this._removeSignalByKey(r)}_listen(r,o,t,f){this._listenersKeys=this._listenersKeys||[];let p=T(this._getEventTarget(r),o,t,f,this);return this._listenersKeys.push(p),p}_unlisten(r,o,t){let f=hr(this._getEventTarget(r),o,t,!1);return!!f&&this._unlistenByKey(f)}_unlistenByKey(r){let o=a(this._listenersKeys),t=o.indexOf(r);return t>=0&&o.splice(t,1),g(r)}_addSignal(r,o,t){this._activeSignals=this._activeSignals||{},r.add(o,this,t);let f=++Mr;return this._activeSignals[f]={dispatcher:r,fn:o,priority:t},f}_addSignalCallOnce(r,o,t){let f=(...p)=>{o.apply(this,p),this._removeSignal(r,f,t)};this._addSignal(r,f,t)}_removeSignal(r,o,t){let f=cr(this._activeSignals,p=>ur(p,{dispatcher:r,fn:o,priority:t}));f&&this._removeSignalByKey(f)}_removeSignalByKey(r){if(!(this._activeSignals&&this._activeSignals[r])){i.warn("unknown signal key");return}let{dispatcher:o,fn:t,priority:f}=this._activeSignals[r];o.remove(t,this,f),delete this._activeSignals[r]}_removeAllEvents(r){if(r){if(this._activeSignals){let o=dr(this._activeSignals,t=>t.dispatcher.eventOwner()===r);for(let t of Object.keys(o))this._removeSignalByKey(t)}if(this._listenersKeys){let o=this._getEventTarget(r),t=this._listenersKeys.filter(f=>f.src===o);for(let f of t)this._unlistenByKey(f)}}}_addDisposable(r){return this._disposables=this._disposables||[],!r||this._disposables.includes(r)||this._disposables.push(r),r}_removeDisposable(...r){if(this._disposables){for(let o of r)if(o){this._cleanItemDependencies(o);let t=this._disposables.indexOf(o);t>=0&&(this._disposables.splice(t,1),Z(o))}}}_cleanItemDependencies(r){this._removeAllEvents(r)}_cleanDependencies(...r){for(let o of r)o&&this._cleanItemDependencies(o)}_getEventTarget(r){return r}_destruct(){}};function Vr(e,r){return e>r?1:e<r?-1:0}function Ur(e,r,o,t,f){let p=0,m=e.length,n;for(;p<m;){let s=p+m>>1,x;o?x=r.call(f,e[s],s,e):x=r(t,e[s]),x>0?p=s+1:(m=s,n=!x)}return n?p:~p}function Br(e,r,o=Vr){return Ur(e,o,!1,r)}function _r(e,r,o){let t=Br(e,r,o);return t<0?(e.splice(-(t+1),0,r),!0):!1}var b=class{constructor(){this._priorities=null,this._values=null,this._zeroPriorityValues=null}push(r,o){this._addPriority(o);let t=this._getPriorityValues(o);t?t.push(r):i.warn("Priority array values are zero")}remove(r,o){let t=this._getPriorityValues(o);t&&ir(t,r)}removeAt(r,o){let t=this._getPriorityValues(o);t&&t.splice(r,1)}getValuesWithPriority(r){if(r===0)return this._zeroPriorityValues||[];if(!this._values)return i.warn("Priority array values are zero"),[];if(!(r in this._values))return[];let o=this._getPriorityValues(r);return o||(i.warn("Priority array values are zero"),[])}getAllValues(){if(!this._values)return this._zeroPriorityValues?this._zeroPriorityValues.slice():[];let r=[],o=a(this._priorities);for(let t=0;t<o.length;++t){let f=o[t],p=this._getPriorityValues(f);p&&r.push(...p)}return r}_addPriority(r){if(r===0){this._zeroPriorityValues=this._zeroPriorityValues||[];return}this._priorities=this._priorities||[0],this._values=this._values||{},r in this._values||(this._values[r]=[],_r(this._priorities,r))}_getPriorityValues(r){return r===0?this._zeroPriorityValues:a(this._values)[r]}};var S=class extends w{constructor(r=null){super(),this._handlers=null,this._owner=r}eventOwner(){return this._owner}add(r,o,t=0){this._handlers=this._handlers||new b,this._handlers.push({fn:r,context:o},t)}addCallOnce(r,o,t=0){let f=p=>{r.call(o,p),this.remove(f,o,t)};this.add(f,o,t)}remove(r,o,t=0){if(!this._handlers){i.warn("Signal has no handlers!");return}let f=this._handlers.getValuesWithPriority(t),p=f.length;for(let m=0;m<p;++m){let n=h(f[m]);if(n.fn===r&&n.context===o){this._handlers.removeAt(m,t);break}}}has(r,o,t=0){if(!this._handlers)return!1;let f=this._handlers.getValuesWithPriority(t),p=f.length;for(let m=0;m<p;++m){let n=h(f[m]);if(n.fn===r&&n.context===o)return!0}return!1}dispatch(r){if(!this._handlers)return;let o=this._handlers.getAllValues(),t=o.length;for(let f=0;f<t;++f){let p=h(o[f]);if(this._handlers.getAllValues().indexOf(p)!==-1)try{p.fn.apply(p.context,[r])}catch(m){rr(m,!0)}}}toFn(){return r=>this.dispatch(r)}handlersCount(){return this._handlers?this._handlers.getAllValues().length:0}};var _=Function("return this")(),kr=()=>!0;function or(e,r){if(kr()){if(r){i.error(e);return}i.warn(e)}}function rr(e,r){let o=e.stack||e.toString();String(o).indexOf(e.message)<0&&or(e.message,r),or(o,r)}var jo=Object.getPrototypeOf({});function Z(e){e&&(a(!e.disposed),mr(e.dispose)&&e.dispose(),e.disposed=!0)}function gr(e,r){let o=e.split("."),t=_;!(a(o[0])in t)&&typeof t.execScript<"u"&&t.execScript("var "+o[0]);for(let f;o.length&&(f=o.shift());)!o.length&&c(r)?t[f]=r:t[f]&&t[f]!==Object.prototype[f]?t=t[f]:t=t[f]={}}_.onerror=function(...e){let[r,,,,o]=e;return o?rr(o,!0):or(r,!0),!0};var er={CLICK:"click",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",CHANGE:"change",SELECTION_CHANGE:"selectionchange",INPUT:"input",TEXT_INPUT:"textInput",KEY_DOWN:"keydown",KEY_PRESS:"keypress",PASTE:"paste",CUT:"cut",COPY:"copy",BLUR:"blur",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",LOAD:"load",LOAD_END:"loadend",LOADED_METADATA:"loadedmetadata",UNLOAD:"unload",BEFOREUNLOAD:"beforeunload",ERROR:"error",DRAG_START:"dragstart",DRAG_OVER:"dragover",DRAG_END:"dragend",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DROP:"drop",RESIZE:"resize",SCROLL:"scroll",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",ORIENTATIONCHANGE:"orientationchange",CUSTOM_CONNECTED:"connected",CUSTOM_DISCONNECTED:"disconnected",TRANSITIONEND:"transitionend",TOUCHSTART:"touchstart",VISIBILITYCHANGE:"visibilitychange"};function D(e,r,o=!0){if(o)return String(parseFloat(e.toFixed(r)));let t=10**r;return String(Math.floor(e*t)/t)}var N=class{constructor(r){this._options=r}usePassedStatus(r){return!!(this._options&(r?2:1))}};function Sr(e){let r=Math.floor(e/3600),o=Math.floor(e%3600/60),t=Math.floor(e%60),f=e-Math.floor(e);return{h:r,m:o,s:t,ms:f}}function tr(e){return e<10?"0"+e:e}function M(e){let r=Sr(e);return"PT"+r.h+"H"+r.m+"M"+r.s+"S"}function v(e){let r=Sr(e);return tr(r.h)+":"+tr(r.m)+":"+tr(r.s)}function C(e){return e<10?"0"+e:e}function yr(e){return typeof e=="number"&&(e=new Date(e)),e.getUTCFullYear()+"-"+C(e.getUTCMonth()+1)+"-"+C(e.getUTCDate())+"T"+C(e.getUTCHours())+":"+C(e.getUTCMinutes())+":"+C(e.getUTCSeconds())+".0Z"}function Er(e){let r=document.createElement("a");r.href="goodbye.html",r.click()}function u(){try{window==window.top?(window.open("","_self",""),window.close()):Er(window)}catch{Er(a(window.top))}}function Tr(e){return e.trim().replace(/[^\w-]/g,"_")}var zr={id:"id",type:"type",score:"weighting",correctResponse:"correct_responses.%INDEX%.pattern",userResponse:"student_response",result:"result",duration:"latency",visitTime:"time"},Fr={id:"id",type:"type",score:"weighting",correctResponse:"correct_responses.%INDEX%.pattern",userResponse:"learner_response",description:"description",result:"result",duration:"latency",visitTime:"timestamp"},Gr={};function Cr(e){return"cmi.interactions."+e+"."}function vr(e){return parseInt(e.getValue("cmi.interactions._count"),10)}function Ir(e,r,o,t,f){if(f){let s=e.id+"_"+e.description,x=Tr(s.substr(0,255));o.setValue(r+t.id,x)}else o.setValue(r+t.id,e.id);o.setValue(r+t.type,e.type),o.setValue(r+t.score,e.score);let p=e.correctResponses||[];for(let s=0;s<p.length;++s){let x=t.correctResponse.replace("%INDEX%",String(s));o.setValue(r+x,p[s])}let m=e.userResponse;m!=null&&o.setValue(r+t.userResponse,m);function n(s){return f&&s==="incorrect"?"wrong":s}o.setValue(r+t.result,n(e.result))}function Rr(e,r){let o=Gr,t=e.id,f=-1;if(e.id in o?f=o[t]:(f=vr(r),o[t]=f),f<0)return;let p=Cr(f),m=zr;Ir(e,p,r,m,!0);let n=e.duration;n!=null&&r.setValue(p+m.duration,v(n/1e3));let s=e.visitTime;if(s!=null){let x=s.getHours()*3600+s.getMinutes()*60+s.getSeconds();r.setValue(p+m.visitTime,v(x))}}function Or(e,r){let o=vr(r);if(o<0)return;let t=Cr(o),f=Fr;Ir(e,t,r,f,!1),r.setValue(t+f.description,e.description);let p=e.duration;p!=null&&r.setValue(t+f.duration,M(p/1e3));let m=e.visitTime;m!=null&&r.setValue(t+f.visitTime,yr(m))}var V={NORMAL:"normal",BROWSE:"browse",REVIEW:"review"};function Ar(e,r){try{for(let t=0;t<255;++t){if(e[r])return e[r];let f=e.parent;if(!f||e==f)break;e=f}}catch{}return null}function U(e,r){return Ar(e,r)||e.opener&&Ar(e.opener,r)}var B=class e{constructor(r,o){this._api=r,this._passed=!1,this._commitsCount=0,this._suspendEnabled=o}static create(r){let o=U(window,"API");return o?new e(o,r):null}initialize(){try{return this._toBool(this._api.LMSInitialize(""))}catch{}return!1}terminate(r){this.setValue("cmi.core.exit",r?this._getSuspendState():""),this.commit();try{return this._toBool(this._api.LMSFinish(""))}catch{}return!1}_getSuspendState(){return this._passed?"":"suspend"}commit(){this._commitsCount==0&&this.setValue("cmi.core.exit",this._suspendEnabled?this._getSuspendState():"");try{let r=this._toBool(this._api.LMSCommit(""));return this._commitsCount+=1,r}catch{}return!1}setPassed(r){this._passed=r}getValue(r){try{return this._api.LMSGetValue(r)}catch{}return""}setValue(r,o){typeof o=="number"&&(o=D(Number(o),2)+"");try{return this._toBool(this._api.LMSSetValue(r,o))}catch{}return!1}_toBool(r){return r=="true"}};var k=class{constructor(r){this._base=B.create(r),this._initialized=!1}initialize(){return this._initialized?!0:(this._initialized=this._base?this._base.initialize():!1,this._initialized)}initializeAsync(r,o){if(this._initialized){r();return}this._base?(this._initialized=this._base.initialize(),this._initialized?r():o()):(this._initialized=!1,o())}terminate(r){return this._base?this._base.terminate(r):!1}commit(){return this._base?this._base.commit():!1}getValue(r){return this._base?this._base.getValue(r):""}setValue(r,o){return this._base?this._base.setValue(r,o):!1}setScore(r,o,t,f){this.setValue("cmi.core.score.raw",r),this.setValue("cmi.core.score.min",o),this.setValue("cmi.core.score.max",t)}setProgress(r){}setSessionTime(r){this.setValue("cmi.core.session_time",v(r/1e3))}getSuspendedData(){return this.getValue("cmi.suspend_data")}getLaunchMode(){return V.NORMAL}setSuspendedData(r){this.setValue("cmi.suspend_data",r)}setStatus(r,o){O(r)?O(o)?this.setValue("cmi.core.lesson_status","unknown"):this.setValue("cmi.core.lesson_status",o?"completed":"incomplete"):this.setValue("cmi.core.lesson_status",r?"passed":"failed")}setPassed(r){h(this._base).setPassed(r)}addInteraction(r){Rr(r,this)}getUserInfo(){return{id:this.getValue("cmi.core.student_id"),name:this.getValue("cmi.core.student_name"),email:""}}};var z={SECOND:"2",THIRD:"3",FOURTH:"4"};var F=class e{constructor(r,o,t){this._api=r,this._edition=o,this._passed=!1,this._commitsCount=0,this._suspendEnabled=t}static create(r,o){let t=U(window,"API_1484_11");return t?new e(t,r,o):null}initialize(){try{return this._toBool(this._api.Initialize(""))}catch{}return!1}terminate(r){this.setValue("cmi.exit",r?this._getSuspendState():"normal"),this.setValue("adl.nav.request","exitAll"),this.commit();try{return this._toBool(this._api.Terminate(""))}catch{}return!1}_getSuspendState(){return this._passed?"":"suspend"}commit(){this._commitsCount==0&&this.setValue("cmi.exit",this._suspendEnabled?this._getSuspendState():"normal");try{let r=this._toBool(this._api.Commit(""));return this._commitsCount+=1,r}catch{}return!1}getValue(r){try{return this._api.GetValue(r)}catch{}return""}setValue(r,o){typeof o=="number"&&(o=D(o,7));try{return this._toBool(this._api.SetValue(r,o))}catch{}return!1}setPassed(r){this._passed=r}getSuspendDataLimit(){return this._edition==z.SECOND?4e3:64e3}_toBool(r){return r=="true"}};var G=class{constructor(r,o){this._base=F.create(r,o),this._initialized=!1}initialize(){return this._initialized?!0:(this._initialized=this._base?this._base.initialize():!1,this._initialized)}initializeAsync(r,o){if(this._initialized){r();return}this._base?(this._initialized=this._base.initialize(),this._initialized?r():o()):(this._initialized=!1,o())}terminate(r){return this._base?this._base.terminate(r):!1}commit(){return this._base?this._base.commit():!1}getValue(r){return this._base?this._base.getValue(r):""}setValue(r,o){return this._base?this._base.setValue(r,o):!1}setScore(r,o,t,f=0){this.setValue("cmi.score.raw",r),this.setValue("cmi.score.min",o),this.setValue("cmi.score.max",t),this.setValue("cmi.score.scaled",f)}setProgress(r){this.setValue("cmi.progress_measure",r)}setSessionTime(r){this.setValue("cmi.session_time",M(r/1e3))}getSuspendedData(){return this.getValue("cmi.suspend_data")}setSuspendedData(r){if(!this._base)throw new Error;let o=this._base.getSuspendDataLimit();r.length<=o&&this.setValue("cmi.suspend_data",r)}getLaunchMode(){return this._base?this._base.getValue("cmi.mode"):V.NORMAL}setStatus(r,o){let t=(f,p,m,n)=>f===null?p:f?m:n;this.setValue("cmi.success_status",t(r,"unknown","passed","failed")),this.setValue("cmi.completion_status",t(o,"unknown","completed","incomplete"))}setPassed(r){this._base&&this._base.setPassed(r)}addInteraction(r){Or(r,this)}getUserInfo(){return{id:this.getValue("cmi.learner_id"),name:this.getValue("cmi.learner_name"),email:""}}};function Pr(){return{onSessionStart:new S,onSessionEnd:new S}}var Kr=6e4;var d=class{constructor(r,o){this._apiVersion=r,this._config=o,this._active=!1,this._playerApi=null,this._suspendEnabled=!0,this._startTime=0,this._lmsApi=null,this._closeEventKeys=[],this._chaptersCompletionStatuses=[],this._longreadResult=null,this._longreadGraded=!1,this._sessionStateNotifier=Pr(),this._commit=X(()=>{},0)}initializeLms(r){try{let o=new N(this._config.flags);this._lmsApi=this._createLmsApi(this._apiVersion,o,this._suspendEnabled),this._commit=X(this._lmsApi.commit.bind(this._lmsApi),Kr)}catch(o){i.error(o),this._onLmsApiInitializationFailed(r)}this._lmsApi&&this._lmsApi.initialize(this._onLmsApiInitialized.bind(this,r),this._onLmsApiInitializationFailed.bind(this,r))}_createLmsApi(r,o,t){}_onLmsApiInitialized(r){let t=a(this._lmsApi).getSuspendData();r(t||void 0).then(p=>this._start(p)),this._closeEventKeys=[T(window,er.UNLOAD,()=>this._closeLms()),T(window,er.BEFOREUNLOAD,()=>this._closeLms())]}_onLmsApiInitializationFailed(r){i.error("Lms initialization failed"),r().then(()=>{})}_start(r){this._playerApi=r,this._active=!0,this._startTime=Date.now(),this._sessionStateNotifier.onSessionStart.dispatch(r.getTitle()),r.onClosePlayerRequest.add(()=>{this._closeLms(),u()}),this._longreadGraded=r.isGraded(),this._chaptersCompletionStatuses=r.getCurrentSectionsStateProgress();let o=()=>{this._longreadResult=r.getLongreadResult(),this._updateUserProgress()};r.onPersistedStateChange.add(()=>this._updatePersistedState()),r.onSectionProgressChange.add(()=>{let t=r.getCurrentSectionIndex(),f=r.getCurrentSectionProgress(),p=a(this._lmsApi),m=t>=0&&!this._chaptersCompletionStatuses[t]&&f>=1;m&&(p.setItemViewed(t),this._chaptersCompletionStatuses[t]=!0),o(),m&&(this._updatePersistedState(),this._commit.flush())}),r.onLongreadResultChange.add(()=>o()),r.onQuizStatisticChange.add(()=>{o(),this._commit.flush()}),o()}_createIri(){return`ispring://roll/${encodeURIComponent(this._config.contentId)}`}_closeLms(){if(this._closeEventKeys)for(let o of this._closeEventKeys)g(o);this._active&&(this._active=!1,this._updateDuration(),this._updateUserProgressOnClose()),this._sessionStateNotifier.onSessionEnd.dispatch();let r=a(this._lmsApi);this._suspendEnabled?r.suspend():r.terminate()}_updateUserProgressOnClose(){}_updateUserProgress(){let r=a(this._lmsApi);this._longreadResult&&(this._longreadGraded&&this._longreadResult.score!==null?(r.setScore(this._longreadResult.score,0,100),r.setStatus(this._longreadResult.longreadPassed,this._longreadResult.completed)):r.setStatus(null,this._longreadResult.completed),r.setProgress(this._longreadResult.progress/100),this._commit().catch(o=>i.error(o)))}_updateDuration(){let r=Date.now()-this._startTime;a(this._lmsApi).setLessonDuration(r)}_updatePersistedState(){this._suspendEnabled&&this._playerApi&&this._lmsApi&&this._lmsApi.setSuspendData(this._playerApi.getSuspendData())}};var y=class{constructor(){this._connector=null}createConnector(){}getLearnerPreferences(){return null}initialize(r,o){this._connector=this.createConnector(),this._connector?this._connector.initializeAsync(r,o):o()}commit(){this._getConnector().commit()}suspend(){this._getConnector().terminate(!0),u()}terminate(){this._getConnector().terminate(!1),u()}setSuspendData(r){this._getConnector().setSuspendedData(r)}getSuspendData(){return this._getConnector().getSuspendedData()}setStatus(r,o){this._getConnector().setStatus(r,o)}setScore(r,o,t,f){let p=t-o>0?r/(t-o):0;f!=null&&(r=p*f,t=f),this._getConnector().setScore(r,o,t,p)}setItemViewed(r){}setProgress(r){this._getConnector().setProgress(r)}setLessonDuration(r){this._getConnector().setSessionTime(r)}getUserInfo(){return this._getConnector().getUserInfo()}_getConnector(){if(!this._connector)throw new Error("Connector not created");return this._connector}};var H=class extends y{constructor(r,o){super(),this._reportOptions=r,this._suspendEnabled=o}createConnector(){return new k(this._suspendEnabled)}setStatus(r,o){this._getConnector().setStatus(r,o)}suspend(){super.suspend(),u()}terminate(){super.terminate(),u()}};var K=class extends y{constructor(r,o=z.SECOND){super(),this._edition=o,this._suspendEnabled=r}createConnector(){return new G(this._edition,this._suspendEnabled)}};function jr(e){return{apiVersion:e.apiVersion,flags:e.flags,contentId:e.contentId,edition:e.edition}}var I=class e extends d{constructor(r){super(r.apiVersion,r),this._scormConfig=r}static create(r){return new e(jr(r))}_createLmsApi(r,o,t){switch(r){case"scorm12":return new H(o,t);case"scorm2004":return new K(t,this._scormConfig.edition)}throw new Error("unknown api version")}};gr("iSpring.roll.LMS.create",I.create);d.prototype.initialize=d.prototype.initializeLms;
